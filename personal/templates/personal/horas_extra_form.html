{% extends 'base/base.html' %}
{% block page_content %}
<div class="container-fluid">
  <div class="card shadow mb-4">
    <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">
        {% if object %}
          <i class="fas fa-edit"></i> Editar Horas Extra - {{ object.fecha|date:"d/m/Y" }}
        {% else %}
          <i class="fas fa-plus"></i> Registrar Horas Extra
        {% endif %}
      </h6>
    </div>
    <div class="card-body">
      <!-- Información sobre Desglose -->
      <div class="alert alert-info mb-4" role="alert">
        <i class="fas fa-lightbulb"></i>
        <strong>¿Cómo funciona?</strong> Solo ingrese el período completo de trabajo.
        <br>El sistema calcula automáticamente:
        <ul class="mb-0 mt-2">
          <li><strong>18:00 - 20:00:</strong> Recargo 25% (horas vespertinas)</li>
          <li><strong>20:00 en adelante:</strong> Recargo 50% (horas nocturnas)</li>
        </ul>
        <br>
        <strong>Ejemplo:</strong> Si registra de 18:00 a 23:15, se crearán automáticamente dos registros:
        <ul class="mb-0 mt-2">
          <li>18:00 - 20:00 → 2h con recargo 25%</li>
          <li>20:00 - 23:15 → 3.25h con recargo 50%</li>
        </ul>
      </div>

      <form method="post">
        {% csrf_token %}
        
        {% if form.non_field_errors %}
        <div class="alert alert-danger" role="alert">
          {{ form.non_field_errors }}
        </div>
        {% endif %}

        <div class="row">
          <div class="col-md-4">
            <div class="form-group">
              {{ form.fecha.label_tag }}
              {{ form.fecha }}
              {% if form.fecha.errors %}<small class="text-danger">{{ form.fecha.errors }}</small>{% endif %}
            </div>
          </div>
          <div class="col-md-4">
            <div class="form-group">
              {{ form.hora_inicio.label_tag }}
              {{ form.hora_inicio }}
              {% if form.hora_inicio.errors %}<small class="text-danger">{{ form.hora_inicio.errors }}</small>{% endif %}
              <small class="form-text text-muted">{{ form.hora_inicio.help_text }}</small>
            </div>
          </div>
          <div class="col-md-4">
            <div class="form-group">
              {{ form.hora_fin.label_tag }}
              {{ form.hora_fin }}
              {% if form.hora_fin.errors %}<small class="text-danger">{{ form.hora_fin.errors }}</small>{% endif %}
              <small class="form-text text-muted">{{ form.hora_fin.help_text }}</small>
            </div>
          </div>
        </div>

        <div class="row mt-2">
          <div class="col-md-12">
            <div class="form-group">
              {{ form.observaciones.label_tag }}
              {{ form.observaciones }}
              {% if form.observaciones.errors %}<small class="text-danger">{{ form.observaciones.errors }}</small>{% endif %}
            </div>
          </div>
        </div>

        <div class="row mt-3">
          <div class="col-md-12">
            <div class="alert alert-info" role="alert">
              <i class="fas fa-hand-holding-usd"></i>
              <strong>Pago por Día (opcional):</strong> Use este campo SOLO para pagos por día completo (ej: limpieza, personal temporal). Si especifica un monto, se creará un registro de pago por día en lugar de horas extra con desglose.
            </div>
          </div>
        </div>

        <div class="row mt-2">
          <div class="col-md-6">
            <div class="form-group">
              {{ form.monto_pago_dia.label_tag }}
              {{ form.monto_pago_dia }}
              {% if form.monto_pago_dia.errors %}<small class="text-danger">{{ form.monto_pago_dia.errors }}</small>{% endif %}
              <small class="form-text text-muted">{{ form.monto_pago_dia.help_text }}</small>
            </div>
          </div>
        </div>

        <div class="mt-3">
          {% if object %}
            <button class="btn btn-success" type="submit">
              <i class="fas fa-save"></i> Actualizar Horas Extra
            </button>
          {% else %}
            <button class="btn btn-primary" type="submit">
              <i class="fas fa-save"></i> Registrar Horas Extra
            </button>
          {% endif %}
          <a href="{% url 'personal:horas-extra-list' %}" class="btn btn-secondary">
            <i class="fas fa-times"></i> Cancelar
          </a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
